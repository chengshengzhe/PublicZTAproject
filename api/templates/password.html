<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>è¼¸å…¥å¯†ç¢¼ - {{FILENAME}}</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #2c3e50; color: #fff; margin: 0;}
    .container { background-color: #34495e; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-align: center; width: 90%; max-width: 400px; }
    h2 { margin-top: 0; }
    p { word-break: break-all; }
    input { width: 100%; padding: 12px; margin: 15px 0; box-sizing: border-box; border-radius: 4px; border: 1px solid #7f8c8d; background-color: #2c3e50; color: #fff; }
    button { width: 100%; padding: 12px; background: #3498db; color: white; border: none; cursor: pointer; border-radius: 4px; font-size: 16px; }
    button:hover { background: #2980b9; }
    .error { color: #e74c3c; margin-top: 10px; height: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ”’ æ­¤æª”æ¡ˆéœ€è¦å¯†ç¢¼</h2>
    <p>æª”æ¡ˆåç¨±ï¼š<strong>{{FILENAME}}</strong></p>
    <form id="pwdForm">
      <input type="password" id="pwd" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
      <button type="submit">ä¸‹è¼‰</button>
    </form>
    <div id="error" class="error"></div>
  </div>
  <script>
    document.getElementById('pwdForm').onsubmit = async (e) => {
      e.preventDefault();
      document.getElementById('error').textContent = '';
      const pwd = document.getElementById('pwd').value;
      
      const res = await fetch(`/api/share/{{TOKEN}}/download`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({password: pwd})
      });
      
      if (res.ok) {
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = '{{FILENAME}}';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      } else {
        document.getElementById('error').textContent = 'å¯†ç¢¼éŒ¯èª¤æˆ–é€£çµå·²å¤±æ•ˆ';
      }
    };
  </script>
</body>
</html>